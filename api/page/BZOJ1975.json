{"title":"BZOJ1975","date":"2017-08-31T16:00:00.000Z","updated":"2018-01-22T10:49:10.000Z","comments":true,"path":"api/page/BZOJ1975.json","content":"<h3 id=\"BZOJ1975-HH去散步-图论-矩阵\"><a href=\"#BZOJ1975-HH去散步-图论-矩阵\" class=\"headerlink\" title=\"[BZOJ1975]HH去散步 图论+矩阵\"></a>[BZOJ1975]HH去散步 图论+矩阵</h3><hr>\n<h4 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h4><p>要求出在一个m条边，n个点的图中，相邻两次走的边不能相同，求在t时间时从起点A走到终点B的路径方案总数。将答案mod45989</p>\n<p><strong>输入格式：</strong><br>第一行：五个整数N，M，t，A，B。<br>后面的m行，每行有两个数 $ a_i $   $b_i$，表示路口$a_i$  $b_i$有有一条边。<br><strong>输出格式：</strong><br>一个整数，表示答案。</p>\n<p><strong>输入输出样例</strong><br><strong>input</strong><br>4 5 3 0 0<br>0 1<br>0 2<br>0 3<br>2 1<br>3 2<br><strong>output</strong><br>4</p>\n<p><strong>Hint</strong></p>\n<p>对于30%的数据，N ≤ 4，M ≤ 10，t ≤ 10。 对于100%的数据，N ≤ 20，M ≤ 60，t ≤ 2^30，0 ≤ A,B</p>\n<hr>\n<p><strong>解题分析</strong><br>题目问你路径的方案总数，首先就想到要用矩阵＋floyd的算法来求。<br>我们根据floyd的原理可以知道$L[i][j]=\\sum\\limits_{k=1}^{n}L[i][k]<em>L[k][j]$<br>所以我们可以建立一个矩阵  $g[i][j]$代表有一条从i到j的比。将这个矩阵幂t次，$g[i][j]$就代表i到j的走t条边的方案数。<br>因为这一题相邻两次走的边不能相同，所以我们就将边变成点来求方案数。<br>那么怎么统计答案呢？我们可以有一个转移矩阵2m</em>2m，其中$f[i][j]$代表第i条边(原图中)的起点与第j条边(原图中)是一个点(且ij不能是同一条边)，就代表点(新图)i与点(新图)j是相连的。答案矩阵是一个1*2m的矩阵,$ans[1][i]$代表第i(原图)条边的终点为题目给的A.把ans与自乘t次的F矩阵相乘。然后<br>　<script type=\"math/tex\">\\sum ans[1][i]（i代表终点为B的点(原图的边)）</script>就是答案。<br>其实我们可以理解为，ans就是加了一个虚点，代表着一个与所有起点为A的点(原图中的边)相连的点。乘后的ans代表这个虚点到所以点的方案。我们只要统计终点为B的点的方案数就可以了。<br>代码自带大常数＝＝！<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;climits&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MAXN (60+10)*2</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> max(a,b) (a&gt;b?a:b)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> min(a,b) (a&lt;b?a:b)</span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> mod=<span class=\"number\">45989</span>,n,m,a,b,t,num,head[MAXN],tot,tail[MAXN],M;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Edge</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> next,to,from,next1;</span><br><span class=\"line\">&#125;edge[MAXN&lt;&lt;<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> from,<span class=\"keyword\">int</span> to)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    edge[++num].next=head[from];</span><br><span class=\"line\">    edge[num].next1=tail[to];</span><br><span class=\"line\">    edge[num].to=to;</span><br><span class=\"line\">    edge[num].from=from;</span><br><span class=\"line\">    head[from]=num;</span><br><span class=\"line\">    tail[to]=num;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">matrix</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> n,m;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> data[MAXN][MAXN];</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">print</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&lt;=m;j++)</span><br><span class=\"line\">                <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d \"</span>,data[i][j]);</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">\"\\n\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    matrix <span class=\"keyword\">operator</span> * (matrix b)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        matrix ans;</span><br><span class=\"line\">        <span class=\"built_in\">memset</span>(ans.data,<span class=\"number\">0</span>,<span class=\"keyword\">sizeof</span>(ans.data));</span><br><span class=\"line\">        ans.n=n;ans.m=b.m;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=ans.n;i++) </span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&lt;=ans.m;j++) </span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> k=<span class=\"number\">1</span>;k&lt;=ans.m;k++)</span><br><span class=\"line\">                    ans.data[i][j]+=(data[i][k]*b.data[k][j])%mod,ans.data[i][j]%=mod;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">too</span><span class=\"params\">(matrix b)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        n=b.n;m=b.m;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++)</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&lt;=m;j++)</span><br><span class=\"line\">                data[i][j]=b.data[i][j];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;f,ans,zero,pf;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">power</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k==<span class=\"number\">1</span>) pf=f;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        power(k/<span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(k%<span class=\"number\">2</span>==<span class=\"number\">1</span>) pf=pf*pf,pf=pf*f;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> pf=pf*pf;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d%d%d\"</span>,&amp;n,&amp;m,&amp;t,&amp;a,&amp;b);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> x,y;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>,&amp;x,&amp;y);</span><br><span class=\"line\">        add(x,y);</span><br><span class=\"line\">        add(y,x);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    f.n=f.m=<span class=\"number\">2</span>*m;ans.n=<span class=\"number\">1</span>;ans.m=<span class=\"number\">2</span>*m;M=<span class=\"number\">2</span>*m;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=head[a];i;i=edge[i].next) ans.data[<span class=\"number\">1</span>][i]=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> s=<span class=\"number\">0</span>;s&lt;n;s++)</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=head[s];i;i=edge[i].next)</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j=head[edge[i].to];j;j=edge[j].next)</span><br><span class=\"line\">            <span class=\"keyword\">if</span>((i+<span class=\"number\">1</span>)!=((j+<span class=\"number\">1</span>)^<span class=\"number\">1</span>))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                f.data[i][j]++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    power(t<span class=\"number\">-1</span>);ans=ans*pf;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=tail[b];i;i=edge[i].next1) </span><br><span class=\"line\">        tot=(tot+ans.data[<span class=\"number\">1</span>][i])%mod;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>,tot);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n","thumbnail":"../img/drawerCover.jpg","primarycolor":"red"}